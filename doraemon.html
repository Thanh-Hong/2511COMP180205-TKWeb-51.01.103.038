<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üß© Gh√©p h√¨nh Doraemon</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">      
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
  <style>
    :root{
      --piece-size:80px;   /* K√≠ch th∆∞·ªõc m·∫£nh: thay ƒë·ªïi n·∫øu mu·ªën */
      --cols:4;
      --rows:3;
    }

    /* Responsive (n·∫øu mu·ªën c√≥ k√≠ch th∆∞·ªõc kh√°c tr√™n m√†n nh·ªè) */
    @media (max-width: 768px){ :root{ --piece-size:64px; } }
    @media (max-width: 420px){ :root{ --piece-size:56px; } }

    body{
      background: linear-gradient(135deg,#fff7db 0%, #dff7ff 50%, #fff0f7 100%);
      margin:0;
      /* font-family:"Comic Sans MS", Arial, sans-serif; */
    }

    .app-wrap{
      max-width:1100px;
      margin:20px auto;
      padding:12px;
      display:flex;
      flex-direction:column;
      align-items:center;
      font-family:"Comic Sans MS", Arial, sans-serif;
      height: 100vh;
    }

    h1 { color:#0077cc; font-size:22px; margin-bottom:12px; }

    .top-area {
      display:flex;
      gap:20px;
      align-items:flex-start;
      justify-content:center;
      flex-wrap:wrap;
    }

    /* --- Khung gh√©p (grid) --- */
    .puzzle-board {
      width: calc(var(--cols) * var(--piece-size));
      height: calc(var(--rows) * var(--piece-size));
      display:grid;
      grid-template-columns: repeat(var(--cols), var(--piece-size));
      grid-template-rows: repeat(var(--rows), var(--piece-size));
      gap:1px;
      background: #9bb7d1;
      border-radius:6px;
      box-shadow:0 4px 10px rgba(0,0,0,0.15);
      touch-action: none; /* ngƒÉn tr√¨nh duy·ªát x·ª≠ l√Ω c·ª≠ ch·ªâ trong v√πng n√†y */
    }

    .dropzone {
      width: var(--piece-size);
      height: var(--piece-size);
      background: #fff;
      border: 0.5px dashed #bbbb;
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
    }

    .dropzone.dropzone-hover { outline: 3px solid rgba(40,167,69,0.9); background:#f6fff6; }

    /* --- M·∫£nh gh√©p --- */
    .pieces {
      margin-top:15px;
      display:grid;
      grid-template-columns: repeat(6, var(--piece-size));
      grid-auto-rows: var(--piece-size);
      gap:6px;
      background:#fff;
      padding:8px;
      border-radius:8px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
      max-width: calc(var(--cols) * var(--piece-size) + 19%);
      overflow-x: auto;     
      scrollbar-width: none;
    }
    .pieces::-webkit-scrollbar {
      display: none;            /* ·∫©n scrollbar tr√™n Chrome, Edge, Safari */
    }
    .piece {
      width: var(--piece-size);
      height: var(--piece-size);
      background-image: url('https://giadinh.mediacdn.vn/thumb_w/640/2017/photo-2-1511253800312.jpg');
      background-size: calc(var(--cols) * var(--piece-size)) calc(var(--rows) * var(--piece-size));
      border:1px solid rgba(0,0,0,0.08);
      border-radius:4px;
      cursor:grab;
      user-select:none; touch-action:none; /* r·∫•t quan tr·ªçng: ngƒÉn vu·ªët trang khi k√©o */
      box-sizing: border-box;
      display:block;
    }
    .piece:active { cursor:grabbing; }

    .original { text-align:center; }
    .original p { margin-bottom:6px; font-size:14px; }
    .original img {
      width: calc(var(--cols) * var(--piece-size) * 0.7);
      border-radius:6px;
      box-shadow:0 3px 8px rgba(0,0,0,0.15);
    }

    .buttons { margin-top:15px; display:flex; gap:10px; flex-wrap:wrap; }
    button { padding:8px 16px; font-size:14px; border:none; border-radius:6px; cursor:pointer; }
    .check-btn { background:#28a745; color:#fff; }
    .reset-btn { background:#ff4081; color:#fff; }

    /* Khi m·∫£nh ƒëang k√©o tr√™n body (absolute) */
    .dragging {
      position:absolute; pointer-events:none; z-index:9999; transform:none !important; box-shadow:0 8px 18px rgba(0,0,0,0.25);
    }

    /* ƒë·∫£m b·∫£o responsive */
    @media (max-width:900px){ .top-area { gap:12px; } }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Nh√≥m 7</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" aria-current="page" href="index.html">Trang ch·ªß</a></li>
          <li class="nav-item"><a class="nav-link" href="muasam.html">Mua s·∫Øm</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Tr√≤ ch∆°i</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="mickey.html">üê≠ Mickey h·ªçc to√°n</a></li>
              <li><a class="dropdown-item" href="doraemon.html">üß© Gh√©p h√¨nh Doraemon</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="app-wrap">
    <h1>üß© Gh√©p h√¨nh Doraemon</h1>

    <div class="top-area">
      <div class="puzzle-board" id="board" aria-label="Khu v·ª±c gh√©p h√¨nh"></div>
      <div class="original">
        <p>üìå H√¨nh m·∫´u</p>
        <img src="https://giadinh.mediacdn.vn/thumb_w/640/2017/photo-2-1511253800312.jpg" alt="M·∫´u Doraemon">
      </div>
    </div>
    <div class="pieces" id="pieces" aria-live="polite"></div>

    <div class="buttons">
      <button class="check-btn" id="checkBtn">‚úÖ Ki·ªÉm tra k·∫øt qu·∫£</button>
      <button class="reset-btn" id="resetBtn">üîÑ Ch∆°i l·∫°i</button>
    </div>
  </div>
  <script>
    // --- C·∫•u h√¨nh ---
    const cols = 4, rows = 3;
    const rootStyles = getComputedStyle(document.documentElement);
    const size = parseInt(rootStyles.getPropertyValue('--piece-size')) || 80;

    const board = document.getElementById('board');
    const piecesContainer = document.getElementById('pieces');

    let dragging = null; // ph·∫ßn t·ª≠ ƒëang k√©o
    let offsetX = 0, offsetY = 0;

    function initGame() {
      board.innerHTML = '';
      piecesContainer.innerHTML = '';

      // t·∫°o dropzones
      for (let i = 0; i < cols * rows; i++) {
        const dz = document.createElement('div');
        dz.className = 'dropzone';
        dz.dataset.index = i;
        board.appendChild(dz);
      }

      // t·∫°o m·∫£nh gh√©p (d·∫°ng tiles t·ª´ ·∫£nh l·ªõn)
      let index = 0;
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          const piece = document.createElement('div');   
          piece.className = 'piece';
          piece.dataset.index = index++;
          piece.style.backgroundPosition = `-${x * size}px -${y * size}px`;
          // g√°n s·ª± ki·ªán pointer ƒë·ªÉ h·ªó tr·ª£ mouse + touch
          piece.addEventListener('pointerdown', onPointerDown);
          piecesContainer.appendChild(piece);
        }
      }

      // x√°o tr·ªôn c√°c m·∫£nh trong container
      shuffleChildren(piecesContainer);
    }

    function shuffleChildren(container) {
      const arr = Array.from(container.children);
      arr.sort(() => Math.random() - 0.5);
      arr.forEach(el => container.appendChild(el));
    }

    // --- X·ª≠ l√Ω pointer (h·ª£p nh·∫•t mouse + touch) ---
    function onPointerDown(e) {
      // ch·ªâ b·∫Øt tr√°i chu·ªôt tr√™n desktop
      if (e.pointerType === 'mouse' && e.button !== 0) return;

      e.preventDefault();
      const piece = e.currentTarget;

      // l·∫•y bounding box hi·ªán t·∫°i
      const rect = piece.getBoundingClientRect();
      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;

      // chu·∫©n b·ªã k√©o: chuy·ªÉn ph·∫ßn t·ª≠ ra body ƒë·ªÉ di chuy·ªÉn t·ª± do
      piece.classList.add('dragging');
      piece.style.width = rect.width + 'px';
      piece.style.height = rect.height + 'px';
      piece.style.left = rect.left + 'px';
      piece.style.top = rect.top + 'px';
      piece.style.position = 'absolute';
      piece.style.pointerEvents = 'none'; // tr√°nh nh·∫≠n pointer trong l√∫c k√©o
      document.body.appendChild(piece);

      dragging = piece;

      // capture pointer ƒë·ªÉ nh·∫≠n pointermove/pointerup ngay c·∫£ khi ra ngo√†i ph·∫ßn t·ª≠
      try { piece.setPointerCapture(e.pointerId); } catch (err) { /* ignore */ }

      window.addEventListener('pointermove', onPointerMove);
      window.addEventListener('pointerup', onPointerUp);
    }

    function onPointerMove(e) {
      if (!dragging) return;
      e.preventDefault();

      const x = e.clientX - offsetX;
      const y = e.clientY - offsetY;
      dragging.style.left = x + 'px';
      dragging.style.top = y + 'px';

      // highlight dropzone hi·ªán t·∫°i (n·∫øu c√≥)
      const under = document.elementFromPoint(e.clientX, e.clientY);
      const zone = under ? under.closest('.dropzone') : null;
      document.querySelectorAll('.dropzone').forEach(z => z.classList.toggle('dropzone-hover', z === zone));
    }

    function onPointerUp(e) {
      if (!dragging) return;
      e.preventDefault();

      const under = document.elementFromPoint(e.clientX, e.clientY);
      const zone = under ? under.closest('.dropzone') : null;

      if (zone) {
        // n·∫øu √¥ ƒë√£ c√≥ m·∫£nh th√¨ chuy·ªÉn m·∫£nh ƒë√≥ v·ªÅ khay
        if (zone.firstElementChild) {
          resetPieceStyle(zone.firstElementChild);
          piecesContainer.appendChild(zone.firstElementChild);
        }
        resetPieceStyle(dragging);
        zone.appendChild(dragging);
      } else {
        // tr·∫£ v·ªÅ khay m·∫£nh
        resetPieceStyle(dragging);
        piecesContainer.appendChild(dragging);
      }

      document.querySelectorAll('.dropzone').forEach(z => z.classList.remove('dropzone-hover'));

      try { dragging.releasePointerCapture(e.pointerId); } catch (err) { /* ignore */ }
      window.removeEventListener('pointermove', onPointerMove);
      window.removeEventListener('pointerup', onPointerUp);
      dragging = null;
    }

    function resetPieceStyle(piece) {
      piece.classList.remove('dragging');
      piece.style.position = '';
      piece.style.left = '';
      piece.style.top = '';
      piece.style.width = '';
      piece.style.height = '';
      piece.style.pointerEvents = '';
    }

    // --- Ki·ªÉm tra k·∫øt qu·∫£ ---
    function checkResult() {
      let correct = true;
      document.querySelectorAll('.dropzone').forEach(zone => {
        const piece = zone.firstElementChild;
        if (!piece || parseInt(piece.dataset.index) !== parseInt(zone.dataset.index)) {
          correct = false;
        }
      });
      if (correct) {
        alert('üéâ Ch√∫c m·ª´ng! B·∫°n ƒë√£ gh√©p ƒë√∫ng Doraemon!');
      } else {
        alert('‚ùå Ch∆∞a ƒë√∫ng, th·ª≠ l·∫°i nh√©!');
      }
    }

    // --- Reset game ---
    function resetGame() {
      initGame();
    }

    // g√°n n√∫t
    document.getElementById('checkBtn').addEventListener('click', checkResult);
    document.getElementById('resetBtn').addEventListener('click', resetGame);

    // kh·ªüi t·∫°o l·∫ßn ƒë·∫ßu
    initGame();
  </script>
</body>
</html>