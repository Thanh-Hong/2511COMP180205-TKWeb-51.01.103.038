<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HTML</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<style>
  :root{ --pad:10px; --cell:220px; }

  /* --- Responsive tuning for mobile/tablet --- */
  @media (max-width: 1200px){ :root{ --cell: 200px; } }
  @media (max-width: 992px){  :root{ --cell: 180px; } }
  @media (max-width: 768px){  :root{ --cell: 160px; } }
  @media (max-width: 576px){  :root{ --cell: 140px; } }

  /* K·ªá ngu·ªìn (grid responsive: auto-fill) */
  .source-wrap{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(var(--cell), 1fr));
    gap:12px; margin:12px 16px 0;
  }

  /* Card s·∫£n ph·∫©m ‚Äì phong c√°ch Shopee */
  .product{
    width:var(--cell); height:var(--cell); padding:8px;
    display:flex; flex-direction:column; align-items:stretch; justify-content:flex-start;
    position:relative; overflow:hidden;
    background:#fff; border:1px solid #eee; border-radius:12px;
    box-shadow:0 2px 6px rgba(0,0,0,.04);
    cursor:grab; user-select:none; touch-action:none;
    transition: transform .15s ease, box-shadow .15s ease;
    box-sizing:border-box;
  }
  .product:hover{ transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,.08); }

  /* ·∫¢nh s·∫£n ph·∫©m: chi·∫øm ~60-65% kh·ªëi */
  .box-product{ flex:0 0 calc(var(--cell) - 88px); height:calc(var(--cell) - 88px); width:100%; object-fit:contain; margin:0 auto; }

  /* T√™n 2 d√≤ng */
  .box-name{
    position:static; margin:4px 0 0; width:auto;
    font:600 14px/1.2 system-ui;
    height:34px; overflow:hidden; display: -webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical;
    line-clamp: 2;
    text-overflow: ellipsis;
  }

  /* Badge NEW ·ªü g√≥c; gi·ªè ·ªü g√≥c */
  .box-new{ position:absolute; top:6px; right:6px; width:24px; height:24px; }
  .box-storage{ position:absolute; right:8px; bottom:8px; width:24px; height:24px; opacity:.95; }

  /* Gi√° cam ƒë·∫≠m */
  .box-price{ position:static; margin-top:auto; font:700 16px/1 system-ui; color:#ee4d2d; }

  /* Khu v·ª±c th·∫£ - responsive width */
  .board{
    position:relative; width: min(100%, 1200px);
    min-height:calc(var(--cell)*2 + var(--pad)*2);
    margin:24px auto; border:3px dashed #aaa; border-radius:10px;
    background:repeating-linear-gradient(45deg,#f9f9f9,#f9f9f9 10px,#f1f1f1 10px,#f1f1f1 20px);
    transition:height .2s ease;
    box-sizing:border-box;
  }
  .placeholder{ width:var(--cell); height:var(--cell); visibility:hidden; }

  .toolbar{ display:flex; gap:10px; align-items:center; margin:16px 16px 0; }
  .toolbar button{ padding:8px 12px; border:1px solid #ccc; background:#fff; border-radius:8px; cursor:pointer; }
  .toolbar button:hover{ background:#f3f3f3; }

  /* T·ªëi ∆∞u kho·∫£ng c√°ch/ƒë·ªám tr√™n mobile */
  @media (max-width:768px){
    .board{
    max-width: 95%;
    border-width: 2px;
    }
    nav .container-fluid{ padding:0 12px;}
  }
</style>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Nh√≥m 7</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" aria-current="page" href="home.html">Trang ch·ªß</a></li>
          <li class="nav-item"><a class="nav-link" href="muasam.html">Mua s·∫Øm</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Tr√≤ ch∆°i</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="mickey.html">üê≠ Mickey h·ªçc to√°n</a></li>
              <li><a class="dropdown-item" href="doraemon.html">üß© Gh√©p h√¨nh Doraemon</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="source-wrap">
    <div class="product draggable" id="product1">
      <div class="box-name"><b>PENCIL IELTS</b></div>
      <img class="box-product" src="https://cdn.pixabay.com/photo/2023/02/11/01/46/pencil-7781876_640.png" width="180" alt="product">
      <img class="box-new" src="https://uxwing.com/wp-content/themes/uxwing/download/e-commerce-currency-shopping/new-icon.png" alt="new">
      <img class="box-storage" src="https://cdn-icons-png.flaticon.com/512/3142/3142740.png" alt="storage">
      <div class="box-price">$2000</div>
    </div>
    <div class="product draggable" id="product2">
      <div class="box-name"><b>CHEAP EARASER</b></div>
      <img class="box-product" src="https://cdn-icons-png.flaticon.com/512/2661/2661282.png" width="180" alt="product">
      <img class="box-new" src="https://uxwing.com/wp-content/themes/uxwing/download/e-commerce-currency-shopping/new-icon.png" alt="new">
      <img class="box-storage" src="https://cdn-icons-png.flaticon.com/512/3142/3142740.png" alt="storage">
      <div class="box-price">$1499</div>
    </div>
    <div class="product draggable" id="product3">
      <div class="box-name"><b>SKIBIDI BOOK</b></div>
      <img class="box-product" src="https://cdn-icons-png.flaticon.com/512/3330/3330314.png" width="180" alt="product">
      <img class="box-new" src="https://uxwing.com/wp-content/themes/uxwing/download/e-commerce-currency-shopping/new-icon.png" alt="new">
      <img class="box-storage" src="https://cdn-icons-png.flaticon.com/512/3142/3142740.png" alt="storage">
      <div class="box-price">$999</div>
    </div>
    <div class="product draggable" id="product4">
      <div class="box-name"><b>STUDENT UNIFORM</b></div>
      <img class="box-product" src="https://png.pngtree.com/png-clipart/20240715/original/pngtree-school-girl-in-uniform-cartoon-illustration-png-image_15565035.png" width="180" alt="product">
      <img class="box-new" src="https://uxwing.com/wp-content/themes/uxwing/download/e-commerce-currency-shopping/new-icon.png" alt="new">
      <img class="box-storage" src="https://cdn-icons-png.flaticon.com/512/3142/3142740.png" alt="storage">
      <div class="box-price">$299</div>
    </div>
  </div>
  <div style="margin:20px 16px; font-size:18px; font-weight:600;">T·ªïng ti·ªÅn: <span id="totalPrice">0</span> USD <button onclick="skibidi()">Mua</button></div>
  <div class="board" id="board"></div>
<script>
  function skibidi(){
    const el = document.getElementById('totalPrice');
    const money = Number((el.textContent || '0').replace(/[^\d.]/g, '')) || 0;
    alert(`B·∫°n ƒë√£ m·∫•t ${money.toLocaleString()} USD. HAHAHHAHAHAHA`);
  }

  (() => {
    const board = document.getElementById('board');
    const source = document.querySelector('.source-wrap');
    const totalEl = (function ensureTotalBox(){
      let el = document.getElementById('totalPrice');
      if (!el) {
        const wrap = document.createElement('div');
        wrap.style.cssText = 'margin:20px 16px;font-size:18px;font-weight:600;';
        wrap.innerHTML = 'T·ªïng ti·ªÅn: <span id="totalPrice">0</span> USD';
        board.insertAdjacentElement('afterend', wrap);
        el = wrap.querySelector('#totalPrice');
      }
      return el;
    })();

    // Helpers to read responsive CSS variable --cell
    function currentCell(){
      const raw = getComputedStyle(document.documentElement).getPropertyValue('--cell');
      const val = parseFloat(raw);
      return Number.isFinite(val) ? val : 220;
    }

    const GRID = { padding: 10, cellW: currentCell(), cellH: currentCell() };
    const meta = new WeakMap();

    document.querySelectorAll('.draggable').forEach((el, i) => { if (!el.id) el.id = 'product_' + (i+1); });

    const boardCols = () => Math.max(1, Math.floor((board.clientWidth - GRID.padding*2) / GRID.cellW));
    const boardRowsForCount = n => Math.ceil(n / boardCols());
    const ensureBoardHeightFor = n => {
      const rows = Math.max(boardRowsForCount(n), 1);
      board.style.height = (GRID.padding*2 + rows*GRID.cellH) + 'px';
    };
    const insideBoardByCenter = r => {
      const br = board.getBoundingClientRect();
      const cx = r.left + r.width/2, cy = r.top + r.height/2;
      return cx>=br.left && cx<=br.right && cy>=br.top && cy<=br.bottom;
    };
    const occupancy = exclude => {
      const set = new Set();
      board.querySelectorAll('.draggable').forEach(el => {
        if (el===exclude) return;
        const left = parseFloat(el.style.left||0), top = parseFloat(el.style.top||0);
        const c = Math.round((left - GRID.padding)/GRID.cellW);
        const r = Math.round((top  - GRID.padding)/GRID.cellH);
        set.add(r+','+c);
      });
      return set;
    };
    function placeNearestFree(el, preferCol, preferRow){
      const cols = boardCols();
      const items = board.querySelectorAll('.draggable').length;
      ensureBoardHeightFor(items);
      const rows = Math.max(boardRowsForCount(items), 1);
      const occ  = occupancy(el);
      let idx = Math.max(0, Math.min(preferRow, rows-1))*cols + Math.max(0, Math.min(preferCol, cols-1));
      const max = rows*cols;
      for(let i=0;i<max;i++){
        const t = (idx+i)%max, r = Math.floor(t/cols), c = t%cols;
        if(!occ.has(r+','+c)){
          const er = el.getBoundingClientRect();
          el.style.left = Math.min(GRID.padding + c*GRID.cellW, board.clientWidth  - er.width) + 'px';
          el.style.top  = Math.min(GRID.padding + r*GRID.cellH,  board.clientHeight - er.height) + 'px';
          return {r,c};
        }
      }
      return null;
    }
    const createPlaceholderLike = el => {
      const ph = document.createElement('div');
      ph.className = 'placeholder';
      ph.style.width = `${GRID.cellW}px`;
      ph.style.height = `${GRID.cellH}px`;
      return ph;
    };
    function updateTotal(){
      let total = 0;
      board.querySelectorAll('.draggable').forEach(el => {
        const priceEl = el.querySelector('.box-price');
        if(priceEl){ total += parseFloat((priceEl.textContent||'').replace(/[^0-9.]/g,'')) || 0; }
      });
      totalEl.textContent = total.toLocaleString();
    }

    function beginDrag(el, e){
      if(!meta.has(el)) meta.set(el,{ originParent: el.parentElement, originNext: el.nextElementSibling, placeholder: null });
      const m = meta.get(el);
      el.classList.add('dragging');
      if(el.parentElement !== board && !m.placeholder){ m.placeholder = createPlaceholderLike(el); el.parentElement.insertBefore(m.placeholder, el.nextElementSibling); }
      const rect = el.getBoundingClientRect();
      el.style.position = 'absolute';
      el.style.width = rect.width + 'px';
      el.style.height = rect.height + 'px';
      el.style.left = (rect.left + window.scrollX) + 'px';
      el.style.top  = (rect.top  + window.scrollY) + 'px';
      document.body.appendChild(el);
      const startOffset = { x: e.clientX - (rect.left + window.scrollX), y: e.clientY - (rect.top + window.scrollY) };

      const onMove = ev => { el.style.left = (ev.clientX - startOffset.x) + 'px'; el.style.top = (ev.clientY - startOffset.y) + 'px'; };
      const onEnd = () => {
        document.removeEventListener('pointermove', onMove);
        document.removeEventListener('pointerup', onEnd);
        el.classList.remove('dragging');
        const er = el.getBoundingClientRect();
        if(insideBoardByCenter(er)){
          if(el.parentElement !== board) board.appendChild(el);
          el.style.position = 'absolute';
          const br = board.getBoundingClientRect();
          const preferCol = Math.round(((er.left - br.left) - GRID.padding)/GRID.cellW);
          const preferRow = Math.round(((er.top  - br.top ) - GRID.padding)/GRID.cellH);
          placeNearestFree(el, preferCol, preferRow);
          const m2 = meta.get(el); if(m2 && m2.placeholder){ m2.placeholder.remove(); m2.placeholder = null; }
        } else {
          const m2 = meta.get(el);
          const parent = (m2 && m2.originParent) || source;
          if(m2 && m2.originNext && m2.originNext.parentElement === parent) parent.insertBefore(el, m2.originNext); else parent.appendChild(el);
          if(m2 && m2.placeholder){ m2.placeholder.remove(); m2.placeholder = null; }
          el.style.position = el.style.width = el.style.height = el.style.left = el.style.top = '';
        }
        ensureBoardHeightFor(board.querySelectorAll('.draggable').length);
        updateTotal();
      };

      document.addEventListener('pointermove', onMove);
      document.addEventListener('pointerup', onEnd, { passive: true });
    }

    function makeDraggable(el){ el.addEventListener('pointerdown', e => { if(e.button!==0 && e.pointerType!=="touch") return; e.preventDefault(); beginDrag(el, e); }, { passive:false }); }

    function reflowOnResize(){
      // Update GRID size from CSS var (--cell) on each resize for responsiveness
      const c = currentCell();
      GRID.cellW = GRID.cellH = c;

      const items = Array.from(board.querySelectorAll('.draggable'));
      ensureBoardHeightFor(items.length);
      const cols = boardCols();
      items.forEach((el, i) => {
        const er = el.getBoundingClientRect();
        const col = i % cols, row = Math.floor(i / cols);
        el.style.left = Math.min(GRID.padding + col*GRID.cellW, board.clientWidth  - er.width) + 'px';
        el.style.top  = Math.min(GRID.padding + row*GRID.cellH,  board.clientHeight - er.height) + 'px';
      });
    }
    window.addEventListener('resize', reflowOnResize);

    document.querySelectorAll('.draggable').forEach(makeDraggable);
    ensureBoardHeightFor(0);
    updateTotal();
  })();
</script>
</body>
</html>